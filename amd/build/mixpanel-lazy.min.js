/**
 * Loads Mixpanel tracker.
 *
 * @copyright Copyright (c) 2021 Open LMS
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_liquidus/mixpanel-lazy",["jquery","core/log"],(function($,Log){var self=this,tracker={};self.addAnalyticsJS=function(){var f,b,e,g,i,h,dfd=$.Deferred(),token=tracker.trackerInfo.token;if(token)return f=document,(b=window.mixpanel||[]).__SV||(window.mixpanel=b,b._i=[],b.init=function(e,f,c){function g(a,d){var b=d.split(".");2==b.length&&(a=a[b[0]],d=b[1]),a[d]=function(){a.push([d].concat(Array.prototype.slice.call(arguments,0)))}}var a=b;for(void 0!==c?a=b[c]=[]:c="mixpanel",a.people=a.people||[],a.toString=function(a){var d="mixpanel";return"mixpanel"!==c&&(d+="."+c),a||(d+=" (stub)"),d},a.people.toString=function(){return a.toString(1)+".people (stub)"},i="disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split(" "),h=0;h<i.length;h++)g(a,i[h]);var j="set set_once union unset remove delete".split(" ");a.get_group=function(){function b(c){d[c]=function(){call2_args=arguments,call2=[c].concat(Array.prototype.slice.call(call2_args,0)),a.push([e,call2])}}for(var d={},e=["get_group"].concat(Array.prototype.slice.call(arguments,0)),c=0;c<j.length;c++)b(j[c]);return d},b._i.push([e,f,c])},b.__SV=1.2,(e=f.createElement("script")).type="text/javascript",e.async=!0,e.src="undefined"!=typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===f.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js",(g=f.getElementsByTagName("script")[0]).parentNode.insertBefore(e,g)),mixpanel.init(token),void 0!==tracker.trackerInfo.trackforms&&tracker.trackerInfo.trackforms&&trackForms(),dfd.resolve(tracker),dfd;Log.debug("Liquidus is misconfigured for Mixpanel, Token is missing.")};const trackForms=()=>{const pageType=void 0!==tracker.trackerInfo.staticShares.pageType?tracker.trackerInfo.staticShares.pageType+"_":"";$("form").each((function(index){const currentForm=$(this);let id=currentForm.attr("id");void 0===id&&(id=currentForm.attr("name")),id=void 0===id?index:index+"_"+id,id=pageType+id;let eventProperties={pageType:pageType,formId:id};skipFormTrack(currentForm[0].baseURI,id)||currentForm.on("submit",(function(){mixpanel.track("Form submitted",eventProperties,{send_immediately:!0}),Log.debug("[mixpanel] Form Submitted Sent.")}))}))};tracker.loadTracker=function(trackerInfo){return tracker.trackerInfo=trackerInfo,self.addAnalyticsJS()},tracker.identify=function(){mixpanel.identify(tracker.trackerInfo.staticShares.userHash)},tracker.trackPage=function(){let data={};if(tracker.trackerInfo.staticShares.plugins){const plugins=tracker.trackerInfo.staticShares.plugins;Object.entries(plugins).forEach((_ref=>{let[type,value]=_ref;data["PluginsUsed_"+type]=value})),delete tracker.trackerInfo.staticShares.plugins}Object.entries(tracker.trackerInfo.staticShares).forEach((_ref2=>{let[type,value]=_ref2;"pageType"===type&&void 0!==tracker.trackerInfo.pagetypeevent&&tracker.trackerInfo.pagetypeevent||(data[type]=value)}));let eventId="Page view";void 0!==tracker.trackerInfo.pagetypeevent&&tracker.trackerInfo.pagetypeevent&&void 0!==tracker.trackerInfo.staticShares.pageType&&(eventId+=" - "+tracker.trackerInfo.staticShares.pageType),mixpanel.track(eventId,data)},tracker.processEvent=function(dfd,metricName,data){mixpanel.track(metricName,data,{send_immediately:!0},(()=>{dfd.resolve(),Log.debug("[mixpanel] Custom event Sent.")}))};const skipFormTrack=function(url,id){const formSkipList=tracker.trackerInfo.skipTrackForms;for(let i=0;i<formSkipList.length;i++)if(url.includes(formSkipList[i])||id.includes(formSkipList[i]))return!0;return!1};return tracker}));

//# sourceMappingURL=mixpanel-lazy.min.js.map