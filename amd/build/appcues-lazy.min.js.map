{"version":3,"file":"appcues-lazy.min.js","sources":["../src/appcues-lazy.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Loads Appcues tracker.\n *\n * @copyright Copyright (c) 2021 Open LMS\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery','core/log'],\n    function($, Log) {\n\n        var self = this;\n\n        var tracker = {};\n\n        self.addAnalyticsJS = function() {\n            const dfd = $.Deferred();\n            const accountid = tracker.trackerInfo.accountid;\n            if (!accountid) {\n                Log.debug('Liquidus is misconfigured for Appcues, Account ID is missing.');\n                return;\n            }\n            /* global Appcues */\n            if (typeof Appcues === 'undefined') {\n                dfd.fail();\n                return dfd;\n            }\n            self.analytics = Appcues;\n            dfd.resolve();\n            return dfd;\n        };\n\n        tracker.loadTracker = function(trackerInfo) {\n            tracker.trackerInfo = trackerInfo;\n            return self.addAnalyticsJS();\n        };\n\n        tracker.identify = function() {\n            let identifyData = {};\n\n            if(typeof tracker.trackerInfo.userProperties !== 'undefined'){\n                for (const property of tracker.trackerInfo.userProperties) {\n                    if(typeof tracker.trackerInfo.staticShares[property] !== 'undefined'){\n                        identifyData[property] = tracker.trackerInfo.staticShares[property];\n                    }\n                }\n            } else {\n                const allUserRolesString = String(tracker.trackerInfo.staticShares.allUserRoles);\n                const userRoleContextString = String(tracker.trackerInfo.staticShares.userRoleContext);\n                const olmsProductString = String(tracker.trackerInfo.staticShares.olmsProduct);\n                const olmsPlatformString = String(tracker.trackerInfo.staticShares.olmsPlatform);\n                const isImpersonatedString = String(tracker.trackerInfo.staticShares.isImpersonated);\n\n                identifyData = {\n                    allUserRoles: allUserRolesString,\n                    userRoleContext: userRoleContextString,\n                    olmsProduct: olmsProductString,\n                    olmsPlatform: olmsPlatformString,\n                    isImpersonated: isImpersonatedString,\n                };\n            }\n\n            // Deck 36 configs.\n            let deck36Configs = tracker.trackerInfo.deck36properties;\n            if (typeof deck36Configs !== 'undefined') {\n                for (const property in deck36Configs) {\n                    identifyData[property] = deck36Configs[property];\n                }\n            }\n            self.analytics.identify(tracker.trackerInfo.staticShares.userHash, identifyData);\n        };\n\n        tracker.trackPage = function() {\n            self.analytics.page();\n            let data = {};\n            if (tracker.trackerInfo.staticShares.plugins) {\n                const plugins = tracker.trackerInfo.staticShares.plugins;\n                Object.entries(plugins).forEach(\n                    ([type, value]) => {\n                        // Dynamically adding property names.\n                        data['PluginsUsed_' + type] = value;\n                    });\n                delete tracker.trackerInfo.staticShares.plugins;\n            }\n            Object.entries(tracker.trackerInfo.staticShares).forEach(\n                ([type, value]) => {\n                    data[type] = value;\n                }\n            );\n            self.analytics.track('Page view', data);\n        };\n\n        tracker.processEvent = function(dfd, metricName, data) {\n            self.analytics.track(metricName, data);\n            // We don't resolve the dfd promise here so we have some time from the API.\n        };\n\n        return tracker;\n    });\n"],"names":["define","$","Log","self","this","tracker","addAnalyticsJS","dfd","Deferred","trackerInfo","accountid","Appcues","fail","analytics","resolve","debug","loadTracker","identify","identifyData","userProperties","property","staticShares","allUserRoles","String","userRoleContext","olmsProduct","olmsPlatform","isImpersonated","deck36Configs","deck36properties","userHash","trackPage","page","data","plugins","Object","entries","forEach","_ref","type","value","_ref2","track","processEvent","metricName"],"mappings":";;;;;;AAqBAA,qCAAO,CAAC,SAAS,aACb,SAASC,EAAGC,SAEJC,KAAOC,KAEPC,QAAU,UAEdF,KAAKG,eAAiB,iBACZC,IAAMN,EAAEO,cACIH,QAAQI,YAAYC,gBAMf,oBAAZC,SACPJ,IAAIK,OACGL,MAEXJ,KAAKU,UAAYF,QACjBJ,IAAIO,UACGP,KAVHL,IAAIa,MAAM,kEAalBV,QAAQW,YAAc,SAASP,oBAC3BJ,QAAQI,YAAcA,YACfN,KAAKG,kBAGhBD,QAAQY,SAAW,eACXC,aAAe,WAE8B,IAAvCb,QAAQI,YAAYU,mBACrB,MAAMC,YAAYf,QAAQI,YAAYU,oBACkB,IAA/Cd,QAAQI,YAAYY,aAAaD,YACvCF,aAAaE,UAAYf,QAAQI,YAAYY,aAAaD,eAG/D,CAOHF,aAAe,CACXI,aAPuBC,OAAOlB,QAAQI,YAAYY,aAAaC,cAQ/DE,gBAP0BD,OAAOlB,QAAQI,YAAYY,aAAaG,iBAQlEC,YAPsBF,OAAOlB,QAAQI,YAAYY,aAAaI,aAQ9DC,aAPuBH,OAAOlB,QAAQI,YAAYY,aAAaK,cAQ/DC,eAPyBJ,OAAOlB,QAAQI,YAAYY,aAAaM,qBAYrEC,cAAgBvB,QAAQI,YAAYoB,yBACX,IAAlBD,kBACF,MAAMR,YAAYQ,cACnBV,aAAaE,UAAYQ,cAAcR,UAG/CjB,KAAKU,UAAUI,SAASZ,QAAQI,YAAYY,aAAaS,SAAUZ,eAGvEb,QAAQ0B,UAAY,WAChB5B,KAAKU,UAAUmB,WACXC,KAAO,MACP5B,QAAQI,YAAYY,aAAaa,QAAS,OACpCA,QAAU7B,QAAQI,YAAYY,aAAaa,QACjDC,OAAOC,QAAQF,SAASG,SACpBC,WAAEC,KAAMC,YAEJP,KAAK,eAAiBM,MAAQC,gBAE/BnC,QAAQI,YAAYY,aAAaa,QAE5CC,OAAOC,QAAQ/B,QAAQI,YAAYY,cAAcgB,SAC7CI,YAAEF,KAAMC,aACJP,KAAKM,MAAQC,SAGrBrC,KAAKU,UAAU6B,MAAM,YAAaT,OAGtC5B,QAAQsC,aAAe,SAASpC,IAAKqC,WAAYX,MAC7C9B,KAAKU,UAAU6B,MAAME,WAAYX,OAI9B5B"}