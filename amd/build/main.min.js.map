{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Liquidus main module. Loads specific trackers.\n *\n * @copyright Copyright (c) 2020 Open LMS\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/log', 'local_liquidus/router'],\nfunction($, Log, Router) {\n\n    const requireTracker = (trackerInfo) => {\n        if (!trackerInfo.trackerId) {\n            return;\n        }\n\n        // Initialize tracker's static shares.\n        trackerInfo.staticShares = {};\n\n        /* global localLiquidusShares */\n        if (typeof localLiquidusShares !== 'undefined'\n            && typeof localLiquidusShares[trackerInfo.trackerId] !== 'undefined'\n        ) {\n            Log.debug(`[${trackerInfo.trackerId}] Found shares, loading.`);\n            trackerInfo.staticShares = localLiquidusShares[trackerInfo.trackerId];\n        }\n\n        require(['local_liquidus/' + trackerInfo.trackerId + '-lazy'], function(tracker) {\n            Log.debug(`[${trackerInfo.trackerId}] Loaded tracker. Initializing.`);\n            Log.debug(trackerInfo);\n            tracker.loadTracker(trackerInfo)\n                .done(() => Router.registerTracker(tracker))\n            ;\n        });\n    };\n\n    /**\n     * Create a single instance for Liquidus to configure a single tracker.\n     * @param {Object} trackerInfo\n     * @constructor\n     */\n    const Liquidus = function(trackerInfo) {\n        Log.debug(`[${trackerInfo.trackerId}] Loading Liquidus.`);\n        Router.init().done(() => {\n            requireTracker(trackerInfo);\n        });\n    };\n\n    return {\n        'init': (trackerInfo) => {\n            const exceptions =\n                'body#page-grade-grading-form-guide-edit #guide-criteria-addcriterion, ' +\n                'body#page-blocks-conduit-view .block_conduit_setting_mappings input[type=\"submit\"]';\n            $('input[type=\"submit\"]').not(exceptions).click(function() {\n                const input = $(this);\n                const form = input.closest('form');\n                const submitField = document.createElement('input');\n                submitField.type = 'hidden';\n                submitField.name = input.attr('name');\n                submitField.value = input.attr('value');\n                form.append(submitField);\n            });\n            return new Liquidus(trackerInfo);\n        }\n    };\n});\n"],"names":["define","$","Log","Router","Liquidus","trackerInfo","debug","trackerId","init","done","staticShares","localLiquidusShares","require","tracker","loadTracker","registerTracker","requireTracker","not","click","input","this","form","closest","submitField","document","createElement","type","name","attr","value","append"],"mappings":";;;;;;AAqBAA,6BAAO,CAAC,SAAU,WAAY,0BAC9B,SAASC,EAAGC,IAAKC,cAgCPC,SAAW,SAASC,aACtBH,IAAII,iBAAUD,YAAYE,kCAC1BJ,OAAOK,OAAOC,MAAK,KAhCCJ,CAAAA,cACfA,YAAYE,YAKjBF,YAAYK,aAAe,GAGQ,oBAAxBC,0BACkD,IAA/CA,oBAAoBN,YAAYE,aAE1CL,IAAII,iBAAUD,YAAYE,uCAC1BF,YAAYK,aAAeC,oBAAoBN,YAAYE,YAG/DK,QAAQ,CAAC,kBAAoBP,YAAYE,UAAY,UAAU,SAASM,SACpEX,IAAII,iBAAUD,YAAYE,8CAC1BL,IAAII,MAAMD,aACVQ,QAAQC,YAAYT,aACfI,MAAK,IAAMN,OAAOY,gBAAgBF,gBAavCG,CAAeX,uBAIhB,MACMA,cAILJ,EAAE,wBAAwBgB,IAFtB,4JAEsCC,OAAM,iBACtCC,MAAQlB,EAAEmB,MACVC,KAAOF,MAAMG,QAAQ,QACrBC,YAAcC,SAASC,cAAc,SAC3CF,YAAYG,KAAO,SACnBH,YAAYI,KAAOR,MAAMS,KAAK,QAC9BL,YAAYM,MAAQV,MAAMS,KAAK,SAC/BP,KAAKS,OAAOP,gBAET,IAAInB,SAASC"}